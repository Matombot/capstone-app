<h1>Vacations</h1>
{{#each vacations}}
<div class="vacation">
<h3>{{name}}</h3>
<p>{{description}}</p>
{{#if inSeason}}
<span class="price">{{price}}</span>
<a href="/cart/add?sku={{sku}}" class="btn btn-default">Buy Now!</a>
{{else}}
<span class="outOfSeason">We're sorry, this vacation is currently
not in season.
{{! The "notify me when this vacation is in season"
page will be our next task. }}
<a href="/notify-me-when-in-season?sku={{sku}}">Notify me when
this vacation is in season.</a>
{{/if}}
</div>
{{/each}}

app.post('/cart/checkout', function(req, res){
var cart = req.session.cart;
124 | Chapter 11: Sending Email
if(!cart) next(new Error('Cart does not exist.'));
var name = req.body.name || '', email = req.body.email || '';
// input validation
if(!email.match(VALID_EMAIL_REGEX))
return res.next(new Error('Invalid email address.'));
// assign a random cart ID; normally we would use a database ID here
cart.number = Math.random().toString().replace(/^0\.0*/, '');
cart.billing = {
name: name,
email: email,
};
res.render('email/cart-thank-you',
{ layout: null, cart: cart }, function(err,html){
if( err ) console.log('error in email template');
mailTransport.sendMail({
from: '"Meadowlark Travel": info@meadowlarktravel.com',
to: cart.billing.email,
subject: 'Thank You for Book your Trip with Meadowlark',
html: html,
generateTextFromHtml: true
}, function(err){
if(err) console.error('Unable to send confirmation: '
+ err.stack);
});
}
);
res.render('cart-thank-you', { cart: cart });
}
